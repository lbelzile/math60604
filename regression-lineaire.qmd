# Régression linéaire {#regression-lineaire}

```{r}
#| label: setup
#| file: "_common.R"
#| include: true
#| eval: true
#| message: false
#| warning: false
#| echo: false
#| cache: false
```


## Introduction

Le modèle de régression linéaire, ou modèle linéaire, est l'un des outils les plus polyvalents pour l'inférence statistique. La régression linéaire est principalement utilisée pour évaluer les effets des variables explicatives (souvent l'effet d'une manipulation ou d'un traitement dans un cadre expérimental) sur la moyenne d'une variable réponse continue, ou pour la prédiction. 
Un modèle linéaire est un modèle qui décrit la moyenne d'une **variable réponse** continue $Y_i$ d'un échantillon aléatoire de taille $n$ comme **fonction linéaire** des **variables explicatives** (également appelés prédicteurs, régresseurs ou covariables) $X_1, \ldots, X_p$.

Dénotons par $Y_i$ la valeur de $Y$ pour le sujet $i$, et $X_{ij}$ la valeur de la $j$e variable explicative du sujet $i$. 
\begin{align}
\underset{\text{moyenne conditionnelle}}{\mathsf{E}(Y_i \mid \boldsymbol{X}_i=\boldsymbol{x}_i)}=\mu_i=\underset{\substack{\text{combinaison linéaire (somme pondérée)}\\ \text{de variables explicatives}}}{\beta_0 + \beta_1x_{i1} + \cdots + \beta_p x_{ip}}\equiv \mathbf{x}_i\boldsymbol{\beta}.
\end{align}
où $\mathbf{x}_i = (1, x_{i1}, \ldots, x_{ip})$ est un vecteur ligne de taille $(p+1)$ contenant les variables explicatives de l'observation $i$ et $\boldsymbol{\beta} = (\beta_0, \ldots, \beta_p)^\top$ est un vecteur colonne de longueur $p+1$ contenant les coefficients de la moyenne. Le fait que la moyenne est conditionnelle aux valeurs de $\mathbf{X}$  implique simplement que l'on considère les régresseurs comme constant, ou connus à l'avance. Les coefficients $\boldsymbol{\beta}$ sont les mêmes pour toutes les observations, mais le vecteurs de variables explicatives $\mathbf{x}_i$ peut différer d'une observation à l'autre. Le modèle est **linéaire** en $\beta_0, \ldots, \beta_p$, pas nécessairement dans les variables explicatives.



Pour simplifier la notation, nous regroupons les observations dans un vecteur $n$ $\boldsymbol{Y}$ et les explications dans une matrice $n \n fois (p+1)$ $\mathbf{X}$ en concaténant une colonne de uns et les vecteurs de colonnes $p$ $\boldsymbol{X}_1, \ldots, \boldsymbol{X}_p$, chacun contenant les $n$ observations des explications respectives. La matrice $\mathbf{X}$ est appelée **matrice du modèle** (ou parfois matrice de devis dans un contexte expérimental), et sa $i$ème ligne est $\mathbf{x}_i$.


En supposant que la  variable réponse provient d'une famille de localisation, nous pouvons réécrire le modèle linéaire en termes de la moyenne plus un aléa,
\begin{align*}
\underset{\text{observation}\vphantom{\mu_i}}{Y_i} = \underset{\text{moyenne } \mu_i}{\vphantom{Y_i}\mathbf{x}_i\boldsymbol{\beta}} + \underset{\text{aléa}\vphantom{\mu_i}}{\vphantom{Y_i}\varepsilon_i},
\end{align*}
où $\varepsilon_i$ est le terme spécifique à l'observation $i$. On assume que les aléas $\varepsilon_1, \ldots \varepsilon_n$ sont indépendants et identiquement distribués, avec $\mathsf{E}(\varepsilon_i \mid \mathbf{x}_i) = 0$ et $\mathsf{Var}(\varepsilon_i \mid \mathbf{x}_i) = \sigma^2$. On fixe l'espérance de l'aléa à zéro car on postule qu’il n’y a pas d’erreur systématique. La variance $\sigma^2$ sert à tenir compte du fait qu’aucune relation linéaire exacte ne lie $\mathbf{x}_i$ et $Y_i$, ou que les mesures de $Y_i$ sont variables.


Le modèle linéaire normal ou gaussien spécifie que les réponses suivent une loi normale, avec $Y_i \mid \boldsymbol{X}_i=\boldsymbol{x}_i \sim \mathsf{normale}(\mathbf{x}_i\boldsymbol{\beta}, \sigma^2)$. La loi normale est une famille de localisation, de sorte que $Y \sim \mathsf{normal}(\mu, \sigma^2)$ équivaut à la décomposition additive $\mu + \varepsilon$ pour $\varepsilon \sim \mathsf{normal}(0, \sigma^2)$.

## Exemples 

Considérons quelques exemples de jeux de données qui serviront à illustrer les méthodes par la suite. 

:::{#exm-lee-choi1}

##  Cohérence de descriptions de produits

L'étude 1 de @Lee.Choi:2019 (base de données `LC19_S1`, paquet `hecedsm`) considère l'impact sur la perception d'un produit de la divergence entre la description textuelle et l'image. Dans leur première expérience, un paquet de six brosses à dents est vendu, mais l'image montre soit un paquet de six, soit une seule). Les auteurs ont également mesuré la familiarité préalable avec la marque de l'article. Les $n=96$ participants ont été recrutés à l'aide d'un panel en ligne. Nous pourrions ajuster un modèle linéaire pour le score moyen d'évaluation du produit, `prodeval`, en fonction de la familiarité de la marque `familiarity`, un nombre entier allant de 1 à 7, et une variable binaire pour le facteur expérimental `consistency`, codé `0` pour des descriptions d'image/texte cohérentes et `1` si elles sont incohérentes. La matrice du modèle qui en résulte est alors de dimension $96\times 3$. La réponse `prodeval` est fortement discrétisée.


```{r}
#| eval: true
#| echo: true
data(LC19_S1, package = "hecedsm")
modmat <- model.matrix( # Matrice du modèle
     ~ familiarity + consistency,
     data = LC19_S1)
tail(modmat, n = 5L) # Imprimer les premières 5 lignes
dim(modmat) # dimension de la matrice du modèle
```

:::




:::{#exm-college-salary-discrimination}

# Discrimination salariale dans un collège américain

 On s'intéresse à la discrimination salariale dans un collège américain, au sein duquel une étude a été réalisée pour investiguer s'il existait des inégalités salariales entre hommes et femmes. Le jeu de données `college` contient les variables suivantes:

-   `salaire`: salaire de professeurs pendant l'année académique 2008--2009 (en milliers de dollars USD).
-   `echelon`: échelon académique, soit adjoint (`adjoint`), aggrégé (`aggrege`) ou titulaire (`titulaire`).
-   `domaine`: variable catégorielle indiquant le champ d'expertise du professeur, soit appliqué (`applique`) ou théorique (`theorique`).
-   `sexe`: indicateur binaire pour le sexe, `homme` ou `femme`.
-   `service`: nombre d'années de service.
-   `annees`: nombre d'années depuis l'obtention du doctorat.

:::


### Analyse exploratoire des données

L'analyse exploratoire des données est une procédure itérative par laquelle nous interrogeons les données, en utilisant des informations auxiliaires, des statistiques descriptives et des graphiques, afin de mieux informer notre modélisation.

Elle est utile pour mieux comprendre les caractéristiques des données (plan d'échantillonnage, valeurs manquantes, valeurs aberrantes), la nature des observations, qu'il s'agisse de variables réponse ou explicatives et les interrelations entre variables.


Voir le [Chapitre 11 de Alexander (2023)](https://tellingstorieswithdata.com/11-eda.html) pour des exemples. En particulier, il convient de vérifier

- que les variables catégorielles sont adéquatement traitées comme des facteurs (`factor`).
- que les valeurs manquantes sont adéquatement déclarées comme telles (code d’erreur, 999, etc.)
- s’il ne vaudrait mieux pas retirer certaines variables explicatives avec beaucoup de valeurs manquantes.
- s’il ne vaudrait mieux pas fusionner des modalités de variables catégorielles si le nombre d’observation par modalité est trop faible.
- qu’il n’y a pas de variable explicative dérivée de la variable réponse
- que le sous-ensemble des observations employé pour l’analyse statistique est adéquat.
- qu’il n’y a pas d’anomalies ou de valeurs aberrantes (par ex., 999 pour valeurs manquantes) qui viendraient fausser les résultats.




:::{#exm-college-aed}

## Analyse exploratoire des données `college`

Une analyse exploratoire des données est de mise avant d'ébaucher un modèle. Si le salaire augmente au fil des ans, on voit que l'hétérogénéité change en fonction de l'échelon et qu'il y a une relation claire entre ce dernier et le nombre d'années de service (les professeurs n'étant éligibles à des promotions qu'après un certain nombre d'années). Les professeurs adjoints qui ne sont pas promus sont généralement mis à la porte, aussi il y a moins d'occasions pour que les salaires varient sur cette échelle.

```{r}
#| label: fig-edacollege
#| eval: true
#| echo: false
#| fig-cap: "Analyse exploratoire des données `college`: répartition des salaires en fonction de l'échelon et du nombre d'années de service"
data(college, package = "hecmodstat")
p1 <- ggplot(college, aes(y = salaire, x = echelon)) +
  geom_boxplot() +
  xlab("échelon académique") +
  ylab("salaire (en milliers de dollars USD)")
p2 <- ggplot(college, aes(x = service, y = salaire, col = sexe)) +
  geom_point() +
  facet_wrap(~ echelon, scales = "free") +
  xlab("années de service") +
  ylab("salaire (en milliers de dollars USD)") + theme(legend.position = "bottom")
library(patchwork)
p1 + p2 + plot_layout(width = c(1,3))
```

Ainsi, le salaire augmente avec les années, mais la variabilité croît également. Les professeurs adjoints qui ne sont pas promus sont généralement mis à la porte, aussi il y a moins d'occasions pour que les salaires varient sur cette échelle. Il y a peu de femmes dans l'échantillon: moins d'information signifie moins de puissance pour détecter de petites différences de salaire. Si on fait un tableau de contingence de l'échelon et du sexe, on peut calculer la proportion relative homme/femme dans chaque échelon: `r round(100*11/(56+11),0)`\% des profs adjoints, `r round(100*10/(54+10),0)`\% pour les aggrégés, mais seulement `r round(100*18/(248+18),0)`\% des titulaires alors que ces derniers sont mieux payés en moyenne.

```{r tableaucontingence, eval = TRUE, echo = FALSE, fig.align = "center"}
knitr::kable(table(college$sexe, college$echelon),
             caption = "Tableau de contingence donnant le nombre de professeurs du collège par sexe et par échelon académique.",
             booktabs = TRUE)
```

Plusieurs des variables explicatives potentielles des données `college` sont cat/gorielles (`echelon`, `sexe`, `discipline`), les deux dernières étant binaires. Les variables numériques `annees` et `service` sont fortement corrélées, avec une corrélation linéaire de `r with(hecmodstat::college, cor(annees, service))`.

:::